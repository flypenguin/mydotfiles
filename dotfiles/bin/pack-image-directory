#!/usr/bin/env bash

if [ -z "$1" ] ; then
  echo "USAGE: $(basename $0) DIRECTORY"
  exit -1
fi

if [ ! -d "$1" ] ; then
  echo "ERROR: Not a directory - $1"
  exit -1
fi

BASENAME=$(basename "$1")
THUMBS_DIR=$(create-thumbnail-dir "$1")
pack-directory -z0 "$1"

zip -r -0 "$BASENAME.pack/$BASENAME.thumbs.zip" "$THUMBS_DIR" > "$THUMBS_DIR.progress.txt"
rm -rf "$THUMBS_DIR" "$THUMBS_DIR.progress.txt"

echo "All done."
