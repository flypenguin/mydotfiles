#!/usr/bin/env bash

if [ -z "$1" ]; then
  echo "USAGE: $(basename $0) DIRECTORY"
  exit -1
fi

if [ ! -d "$1" ]; then
  echo "ERROR: Not a directory - $1"
  exit -1
fi

BASENAME=$(basename "$1")
THUMBS_DIR="$1.thumbs"

echo "Archiving directory:   [$1]"

create-thumbnail-dir "$1"
pack-directory -c 0 "$1"

zip -r -0 "$BASENAME.pack/$BASENAME.thumbs.zip" "$THUMBS_DIR" >"$THUMBS_DIR.progress.txt"
rm -rf "$THUMBS_DIR" "$THUMBS_DIR.progress.txt"

echo -e "All done.\n"
